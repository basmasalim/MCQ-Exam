<div class="space-y-2 mb-5 relative">
  <label class="text-sm font-medium">{{ label }}</label>

  <div class="flex w-full relative">
    <!-- زر Dropdown -->
    <button
      (click)="toggleDropdown()"
      type="button"
      class="items-center justify-center whitespace-nowrap text-sm font-medium border-2 border-gray-200 bg-gray-50 hover:bg-gray-100 text-gray-800 py-3 flex gap-1 rounded-e-none border-r-0 px-3 focus:z-10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 cursor-pointer"
    >
      <span
        class="flex h-4 w-6 overflow-hidden rounded-sm bg-foreground/20 [&_svg:not([class*='size-'])]:size-full"
      >
        <img [src]="selectedCountry()?.flags?.svg" class="w-full h-full object-cover" />
      </span>
      <span class="text-xs font-medium">{{ selectedCountry()?.idd?.root || '' }}</span>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="lucide lucide-chevrons-up-down -mr-2 size-4 opacity-50"
        aria-hidden="true"
      >
        <path d="m7 15 5 5 5-5"></path>
        <path d="m7 9 5-5 5 5"></path>
      </svg>
    </button>
    <!-- Phone input -->
    <input
      class="input-field flex-1"
      autocomplete="tel"
      placeholder="Enter a phone number"
      type="tel"
      [formField]="field"
    />

    <!-- Dropdown List -->
    @if (dropdownOpen()) {
      <div
        class="absolute z-50 top-full left-0 md:-left-2/5 mt-0.5 w-64 sm:w-80 bg-white border border-gray-200 rounded shadow-lg"
        (click)="$event.stopPropagation()"
      >
        <!-- Search input -->
        <div class="flex items-center border-b border-gray-200 py-1 px-2">
          <img src="icons/search.svg" alt="search" class="w-4" />

          <input
            type="text"
            placeholder="Search country..."
            class="w-full px-3 py-2 focus:outline-none text-sm"
            [value]="searchTerm()"
            (input)="onSearchChange($event)"
            (click)="$event.stopPropagation()"
          />
        </div>

        <!-- Countries list -->
        <ul class="max-h-64 overflow-y-scroll overflow-x-hidden">
          @for (country of filteredCountries(); track country.cca2) {
            <li
              (click)="selectCountry(country)"
              class="px-3 py-2 text-xs font-medium hover:bg-gray-100 cursor-pointer flex items-center gap-2 border-b border-gray-50 last:border-b-0"
            >
              <img [src]="country.flags.svg" class="w-5 h-3 object-cover" />
              <span class="flex-1">{{ country.name.common }}</span>
              <span class="text-gray-500">{{ country.idd.root }}{{ country.idd.suffixes }}</span>
            </li>
          }
        </ul>
      </div>
    }
  </div>

  <!-- Errors -->
  @if (field().touched() && field().errors().length) {
    @for (error of field().errors(); track error) {
      <p class="text-red-500 text-sm">{{ error.message }}</p>
    }
  }
</div>
